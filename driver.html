<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Dashboard</title>
    <style>
        :root {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #f4f6f8;
            color: #111;
        }
        
        header {
            background: #000;
            color: white;
            padding: 18px 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        
        .driver-name {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .wrap {
            display: grid;
            grid-template-columns: 380px 1fr 380px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 18px rgba(11, 99, 255, 0.08);
        }
        
        h2 {
            margin: 0 0 16px 0;
            font-size: 1.2rem;
            color: #0b63ff;
            border-bottom: 2px solid #e6eefc;
            padding-bottom: 8px;
        }
        
        .ride {
            border: 1px solid #e6eefc;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            background: #fafbff;
            transition: all 0.2s ease;
        }
        
        .ride:hover {
            box-shadow: 0 4px 12px rgba(11, 99, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 16px;
            border-radius: 8px;
            border: 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-accept {
            background: #10b981;
            color: white;
        }
        
        .btn-accept:hover {
            background: #059669;
        }
        
        .btn-decline {
            background: #ef4444;
            color: white;
        }
        
        .btn-decline:hover {
            background: #dc2626;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        .stat-grid {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .stat {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, #fafbff 0%, #f0f4ff 100%);
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e6eefc;
        }
        
        .stat > div:first-child {
            font-size: 1.8rem;
            font-weight: bold;
            color: #0b63ff;
            margin-bottom: 4px;
        }
        
        .stat > div:last-child {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .feedback {
            border-bottom: 1px dashed #e6eefc;
            padding: 12px 0;
        }
        
        .feedback:last-child {
            border-bottom: none;
        }
        
        .chat {
            display: flex;
            flex-direction: column;
            height: 500px;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            border: 1px solid #e6eefc;
            border-radius: 10px;
            margin-bottom: 12px;
            background: #fafbff;
        }
        
        .message {
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .message.me {
            text-align: right;
            margin-left: auto;
            background: #0b63ff;
            color: white;
        }
        
        .message.them {
            background: #f0f4ff;
            color: #111;
        }
        
        .activity-item {
            padding: 10px;
            border-left: 3px solid #0b63ff;
            background: #fafbff;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        input, select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 0.95rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #0b63ff;
            box-shadow: 0 0 0 3px rgba(11, 99, 255, 0.1);
        }
        
        footer {
            padding: 16px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }
        
        /* Custom scrollbar styling */
        #activityLog::-webkit-scrollbar,
        #feedbackList::-webkit-scrollbar {
            width: 8px;
        }
        
        #activityLog::-webkit-scrollbar-track,
        #feedbackList::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #activityLog::-webkit-scrollbar-thumb,
        #feedbackList::-webkit-scrollbar-thumb {
            background: #0b63ff;
            border-radius: 4px;
        }
        
        #activityLog::-webkit-scrollbar-thumb:hover,
        #feedbackList::-webkit-scrollbar-thumb:hover {
            background: #0952d9;
        }
            
        @media (max-width: 1200px) {
            .wrap {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header> <!--Here we will present the driver's username-->
       <span class="driver-name" id="driverName">
        <span class="profile-username" id="navbar-username"></span>
       </span>
    </header>   
    
    <!-- takes care of the rides -->
    <div class="wrap">
        <!-- Left column: Incoming rides + stats -->
        <div>
            <div class="card" id="incoming-card">
                <h2>üìç Incoming Ride Requests</h2>
                <div id="incoming-list">
                    <!--This is empty because inside incoming-list we take care of the else -->
                </div>
                <div style="margin-top: 16px; display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-small" onclick="pollNow()">üîÑ Refresh</button>
                    <label style="font-size: 0.9rem; display: flex; align-items: center; gap: 6px;">
                        <input id="autoPoll" type="checkbox" checked /> Auto-refresh (5s)
                    </label>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üìä Statistics</h2>
                <div style="margin-bottom: 12px;">
                    <select id="statsPeriod" onchange="loadStats()">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                    </select>
                </div>
                <div id="statsArea">
                    <div class="stat-grid">
                        <div class="stat">
                            <div id="stat-rides">--</div>
                            <div>Rides</div>
                        </div>
                        <div class="stat">
                            <div id="stat-earnings">--</div>
                            <div>Earnings</div>
                        </div>
                        <div class="stat">
                            <div id="stat-rating">--</div>
                            <div>Rating</div>
                        </div>
                    </div>
                    <canvas id="statsChart" width="600" height="180" style="border-radius: 8px; background: #fafbff; border: 1px solid #e6eefc;"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Center column: Activity log + Feedback -->
        <div>
            <div class="card">
                <h2>üìã Activity Log</h2>
                <div id="activityLog" style="max-height: 400px; overflow-y: auto;">
                    <div style="padding: 20px; text-align: center; color: #999;">No activity yet</div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>‚≠ê Customer Feedback</h2>
                <div id="feedbackList" style="max-height: 400px; overflow-y: auto;">
                    <div class="loading">Loading feedback...</div> <!-- CHANGE-->
                </div>
            </div>
        </div>
        
        <!-- Right column: Chat + Controls -->
        <div>
            <div class="card chat">
                <h2>üí¨ Chat with Customer</h2>
                <div style="margin-bottom: 12px; display: flex; gap: 10px;">
                    <input id="chatCustId" style="flex: 1;" placeholder="Enter customer ID" />
                    <button class="btn btn-small" onclick="startChat()">Start Chat</button>
                </div>
                <div class="messages" id="messages">
                    <div style="text-align: center; color: #999; padding: 20px;">
                        Enter a customer ID and click "Start Chat" to begin
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input id="msgInput" placeholder="Type your message..." style="flex: 1;" onkeypress="if(event.key==='Enter')sendMessage()" />
                    <button class="btn btn-small" onclick="sendMessage()">Send</button>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üéõÔ∏è Driver Controls</h2>
                <div style="margin-bottom: 12px; font-weight: 600;">Availability Status:</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-small btn-accept" onclick="setAvailability(1)" style="flex: 1;">
                        ‚úÖ Go Online
                    </button>
                    <button class="btn btn-small btn-decline" onclick="setAvailability(0)" style="flex: 1;">
                        ‚õî Go Offline
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="card">
        <strong>Note:</strong> This dashboard requires backend API endpoints. Ensure your server returns JSON with the expected fields.
    </footer>  
  <script src="driver.js" defer></script>
</body>
</html>