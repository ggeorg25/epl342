<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rent a car | OSRH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>

<body>

    <header class="navbar">
        <a href="homepage_pas.html" class="OSRH">One-Stop Ride-Hail</a>

    <div class="profile-text">
      <span class="profile-label">Welcome</span>
      <span class="profile-username" id="navbar-username"></span>
    </div>
  </header>

  <main class="main">
    <section class="hero-card">
      <h1 class="hero-title">Rent a car</h1>
      
      <form id="passenger-form">
        
   
    <h2 class="section-title">1. Ride Type </h2>
        <div class="form-group">
          <label for="service_type">Ride Type</label>
          <select id="service_type" name="service_type">
            <option value="11">Standard passenger ride</option>
            <option value="12">Premium passenger ride</option>
            <option value="13">Light cargo transport</option>
            <option value="14">Heavy cargo transport</option>
          </select>
        </div>

        <h2 class="section-title">2. Duration </h2>

            <label for="start">Rental start (date & time):</label>
            <input 
              type="datetime-local" 
              id="start" 
              name="rental_start" 
              required
            >
            <br><br>
          
            <label for="end">Rental end (date & time):</label>
            <input 
              type="datetime-local" 
              id="end" 
              name="rental_end" 
              required
            >
            <br><br>
     
            <div class="button-row">
                <button type="submit" class="btn-primary">
                  Continue
                </button>
              </div>
              
      </form>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const storedUsername = localStorage.getItem('username') || 'User';
      const navbarUsernameEl = document.getElementById('navbar-username');
      if (navbarUsernameEl) navbarUsernameEl.textContent = storedUsername;

      const form = document.getElementById('passenger-form');
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        const serviceType = document.getElementById('service_type').value;
        const rentalStart = document.getElementById('start').value;
        const rentalEnd = document.getElementById('end').value;

        if (!rentalStart || !rentalEnd) {
          alert('Please select both start and end dates.');
          return;
        }

        // Validate end is after start
        if (new Date(rentalEnd) <= new Date(rentalStart)) {
          alert('End date must be after start date.');
          return;
        }

        // Convert datetime-local format (YYYY-MM-DDTHH:MM) to SQL Server format (YYYY-MM-DD HH:MM:SS)
        const formatForSQL = (datetimeLocal) => {
          return datetimeLocal.replace('T', ' ') + ':00';
        };

        // Save to session via PHP
        const body = new URLSearchParams();
        body.append('service', 'rental');
        body.append('service_type', serviceType);
        body.append('rental_start', formatForSQL(rentalStart));
        body.append('rental_end', formatForSQL(rentalEnd));

        fetch('set_session.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: body.toString()
        })
        .then(res => res.json())
        .then(resp => {
          if (resp && resp.success) {
            window.location.href = 'vehicle_options.html';
          } else {
            alert('Could not save session. Try again.');
          }
        })
        .catch(err => {
          console.error('Session save error', err);
          alert('Network error saving session.');
        });
      });
    });
  </script>
</body>
</html>
