<head>
    <meta charset="UTF-8" />
    <title>Driver Request | OSRH</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css">
  </head>
  
  <body>
    <header class="navbar">
      <a href="homepage_pas.html" class="OSRH">One-Stop Ride-Hail</a>
      <div class="profile-text">
        <span class="profile-label">Welcome</span>
        <span class="profile-username" id="navbar-username"></span>
      </div>
    </header>
  
    <main class="main">
      <section class="hero-card">
        <h1 class="hero-title">
          Rent a Car
        </h1>
    
        <div id="driver-rent-message" style="margin-top: 10px; white-space: pre-line;"></div>
        
        <script>
          document.addEventListener('DOMContentLoaded', function () {
       
  const link   = document.getElementById('request-driver-link');
  const msgDiv = document.getElementById('driver-rent-message');

  if (!link || !msgDiv) return;   

  link.addEventListener('click', function (e) {
    e.preventDefault();
             
              msgDiv.textContent = '';
              msgDiv.style.color = 'red';
        
          fetch('checkRentDocs.php', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({})
                });
              })
              .then(response => {
                if (!response) return;
                return response.json();
              })
              .then(data => {
                if (!data) return; 
                
                console.log('Document Status Response:', data);
        
                if (data.status === 'no_docs') {
               
                  window.location.href = 'rent.html';
        
                } else if (data.status === 'has_issues') {
                
                  msgDiv.style.color = 'blue';
                  msgDiv.style.fontWeight = 'bold';
                  msgDiv.textContent = 'Redirecting to resubmit page...';
                  
                  setTimeout(() => {
                    window.location.href = 'resubmit_rent_docs.html';
                  }, 500);
        
                } else if (data.status === 'pending') {
              
                  msgDiv.style.color = 'orange';
                  msgDiv.style.fontWeight = 'bold';
                  msgDiv.textContent = data.message || 'All documents are pending approval.';
        
                } else if (data.status === 'error') {
                
                  msgDiv.style.color = 'red';
                  msgDiv.style.fontWeight = 'bold';
                  msgDiv.textContent = data.message || 'Something went wrong.';
                  
                } else {
                 
                  msgDiv.style.color = 'red';
                  msgDiv.style.fontWeight = 'bold';
                  msgDiv.textContent = 'Unexpected response. Please try again later.';
                  console.error('Unknown status:', data.status, data);
                }
              })
              .catch(err => {
                console.error(err);
                msgDiv.style.color = 'red';
                msgDiv.style.fontWeight = 'bold';
                msgDiv.textContent = 'Something went wrong. Please try again later.';
              });
            });
      
        </script>
        <form id="driverForm">
  
          <section class="form-section">
            <h2>Required Documnets</h2>
  
           
            <div class="doc-block" data-required-doc="true">
              <h3>ID / Passport</h3>
              <input type="hidden" name="driver_docs[0][d_doc_type]" value="7">
  
              <div class="form-row">
                <label for="id_doc_code">Document Code</label>
                <input type="text" id="id_doc_code" name="driver_docs[0][doc_code]" required>
              </div>
  
              <div class="form-row">
                <label for="id_doc_publish">Issue Date</label>
                <input type="date" id="id_doc_publish" name="driver_docs[0][d_doc_publish_date]" required>
              </div>
  
              <div class="form-row">
                <label for="id_doc_exp">Expiration Date</label>
                <input type="date" id="id_doc_exp" name="driver_docs[0][d_doc_ex_date]">
              </div>
  
              <div class="form-row">
                <label for="id_doc_file">File (image/pdf)</label>
                <input type="file" id="id_doc_file" name="driver_docs[0][image_pdf]" accept=".pdf,image/*" required>
                <small style="color: red; display: block; margin-top: 5px;">Maximum 2MB</small>
              </div>
            </div>
  
            
            <div class="doc-block" data-required-doc="true">
              <h3>Driving License</h3>
              <input type="hidden" name="driver_docs[2][d_doc_type]" value="9">
  
              <div class="form-row">
                <label for="dl_code">Document Code</label>
                <input type="text" id="dl_code" name="driver_docs[2][doc_code]" required>
              </div>
  
              <div class="form-row">
                <label for="dl_publish">Issue Date</label>
                <input type="date" id="dl_publish" name="driver_docs[2][d_doc_publish_date]" required>
              </div>
  
              <div class="form-row">
                <label for="dl_exp">Expiration Date</label>
                <input type="date" id="dl_exp" name="driver_docs[2][d_doc_ex_date]">
              </div>
  
              <div class="form-row">
                <label for="dl_file">File (image/pdf)</label>
                <input type="file" id="dl_file" name="driver_docs[2][image_pdf]" accept=".pdf,image/*" required>
                <small style="color: red; display: block; margin-top: 5px;">Maximum 2MB</small>
              </div>
            </div>
  

          <button type="button" id="submitBtn">
            Continue
          </button>
          
          <div id="alert">
            <span id="alert-text"></span>
          </div>
  
        </form>
      </section>
    </main>
    
    <script src="rent_docs.js"></script>
  </body>
  </html>